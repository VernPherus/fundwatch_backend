generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Payee {
  id            Int            @id @default(autoincrement())
  name          String
  address       String?        @map("address")
  type          String?        @default("supplier")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  disbursements Disbursement[]

  @@map("payees")
}

model FundSource {
  id             Int            @id @default(autoincrement())
  code           String         @unique
  name           String
  initialBalance Decimal        @default(0) @db.Decimal(15, 2)
  description    String?
  isActive       Boolean        @default(true) @map("is_active")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  disbursements  Disbursement[]

  @@map("fund_sources")
}

model Disbursement {
  id              Int                      @id @default(autoincrement())
  payeeId         Int?                     @map("payee_id")
  fundSourceId    Int?                     @map("fund_source_id")
  lddapNum        String?                  @map("lddap_num")
  acicNum         String?                  @map("acic_num")
  orsNum          String?                  @map("ors_num")
  dvNum           String?                  @map("dv_num")
  uacsCode        String?                  @map("uacs_code")
  respCode        String?                  @map("resp_code")
  dateReceived    DateTime?                @map("date_received")
  dateEntered     DateTime                 @default(now()) @map("date_entered")
  grossAmount     Decimal                  @map("gross_amount") @db.Decimal(15, 2)
  totalDeductions Decimal                  @default(0) @map("total_deductions") @db.Decimal(15, 2)
  netAmount       Decimal                  @map("net_amount") @db.Decimal(15, 2)
  particulars     String?
  method          String
  status          String                   @default("pending")
  approvedAt      DateTime?                @map("approved_at")
  createdAt       DateTime                 @default(now()) @map("created_at")
  updatedAt       DateTime                 @updatedAt @map("updated_at")
  deletedAt       DateTime?                @map("deleted_at")
  ageLimit        Int                      @default(5)
  deductions      DisbursementDeductions[]
  items           DisbursementItem[]
  fundSource      FundSource?              @relation(fields: [fundSourceId], references: [id])
  payee           Payee?                   @relation(fields: [payeeId], references: [id])

  @@index([lddapNum])
  @@index([acicNum])
  @@index([orsNum])
  @@index([dvNum])
  @@index([uacsCode])
  @@index([respCode])
  @@index([method])
  @@index([status])
  @@map("disbursements")
}

model DisbursementItem {
  id             Int           @id @default(autoincrement())
  disbursementId Int?          @map("disbursement_id")
  description    String
  accountCode    String?       @map("account_code")
  amount         Decimal       @db.Decimal(15, 2)
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  disbursement   Disbursement? @relation(fields: [disbursementId], references: [id])

  @@map("disbursement_items")
}

model DisbursementDeductions {
  id            Int          @id @default(autoincrement())
  disbursemenId Int          @map("disbursement_id")
  deductionType String       @map("deduction_type")
  amount        Decimal      @db.Decimal(15, 2)
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")
  disbursement  Disbursement @relation(fields: [disbursemenId], references: [id])

  @@map("disbursement_deductions")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String?  @map("username")
  firstName String   @map("first_name")
  lastName  String   @map("last_name")
  email     String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  logs      Logs[]

  @@map("users")
}

model Logs {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  log       String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("logs")
}

enum Role {
  USER
  ADMIN
  APPROVER
}
