generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Payee {
  id            Int            @id @default(autoincrement())
  name          String
  address       String?        @map("address")
  type          String?        @default("supplier")
  tinNum        String?        @map("tin_number")
  bankName      String?        @map("bank_name")
  bankBranch    String?        @map("bank_branch")
  accountName   String?        @map("account_name")
  accountNumber String?        @map("account_number")
  contactPerson String?        @map("contact_person")
  mobileNum     String?        @map("mobile_number")
  email         String?        @map("email")
  isActive      Boolean        @default(true) @map("is_active")
  remarks       String?        @db.Text
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  disbursements Disbursement[]

  @@map("tb_payees")
}

model FundSource {
  id             Int            @id @default(autoincrement())
  code           String         @unique
  name           String
  initialBalance Decimal        @default(0) @db.Decimal(15, 2)
  description    String?
  isActive       Boolean        @default(true) @map("is_active")
  createdAt      DateTime       @default(now()) @map("created_at")
  reset          Reset          @default(NONE)
  updatedAt      DateTime       @updatedAt @map("updated_at")
  disbursements  Disbursement[]
  fundEntries    FundEntry[]

  @@map("tb_fund_sources")
}

model FundEntry {
  id           Int         @id @default(autoincrement())
  fundSourceId Int         @map("fund_source_id")
  name         String
  amount       Decimal     @default(0) @db.Decimal(15, 2)
  createdAt    DateTime    @default(now()) @map("created_at")
  fundSource   FundSource? @relation(fields: [fundSourceId], references: [id])

  @@map("tb_fund_entry")
}

model References {
  id           Int           @id @default(autoincrement())
  disbId       Int           @map("disbursement_id")
  acicNum      String        @map("acic_num")
  orsNum       String        @map("ors_num")
  dvNum        String        @map("dv_num")
  uacsCode     String        @map("uacs_code")
  respCode     String        @map("resp_code")
  disbursement Disbursement? @relation(fields: [disbId], references: [id])

  @@index([acicNum, orsNum, dvNum, uacsCode, respCode])
  @@map("tb_references")
}

model Disbursement {
  id              Int                      @id @default(autoincrement())
  payeeId         Int?                     @map("payee_id")
  fundSourceId    Int?                     @map("fund_source_id")
  lddapNum        String?                  @map("lddap_num")
  checkNum        String?                  @map("checkNum")
  dateReceived    DateTime                 @map("date_received")
  dateEntered     DateTime                 @default(now()) @map("date_entered")
  grossAmount     Decimal                  @map("gross_amount") @db.Decimal(15, 2)
  totalDeductions Decimal                  @default(0) @map("total_deductions") @db.Decimal(15, 2)
  netAmount       Decimal                  @map("net_amount") @db.Decimal(15, 2)
  particulars     String?
  method          Method?
  lddapMthd       LddapMethod?
  status          Status                   @default(PAID)
  approvedAt      DateTime?                @map("approved_at")
  createdAt       DateTime                 @default(now()) @map("created_at")
  updatedAt       DateTime                 @updatedAt @map("updated_at")
  deletedAt       DateTime?                @map("deleted_at")
  ageLimit        Int                      @default(5)
  deductions      DisbursementDeductions[]
  items           DisbursementItem[]
  fundSource      FundSource?              @relation(fields: [fundSourceId], references: [id])
  payee           Payee?                   @relation(fields: [payeeId], references: [id])
  references      References[]

  @@index([status, method, lddapNum])
  @@map("tb_disbursements")
}

model DisbursementItem {
  id             Int           @id @default(autoincrement())
  disbursementId Int?          @map("disbursement_id")
  description    String
  accountCode    String?       @map("account_code")
  amount         Decimal       @db.Decimal(15, 2)
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  disbursement   Disbursement? @relation(fields: [disbursementId], references: [id])

  @@map("tb_disbursement_items")
}

model OTP {
  id        Int      @id @default(autoincrement())
  email     String
  otp       String
  isUsed    Boolean  @default(false) @map("is_used")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([email, otp])
  @@map("tb_otp")
}

model DisbursementDeductions {
  id             Int          @id @default(autoincrement())
  disbursementId Int          @map("disbursement_id")
  deductionType  String       @map("deduction_type")
  amount         Decimal      @db.Decimal(15, 2)
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  disbursement   Disbursement @relation(fields: [disbursementId], references: [id])

  @@map("tb_disbursement_deductions")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String?  @map("username")
  firstName String   @map("first_name")
  lastName  String   @map("last_name")
  email     String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  logs      Logs[]

  @@map("tb_users")
}

model Logs {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  log       String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("tb_logs")
}

enum Role {
  USER
  ADMIN
  STAFF @map("APPROVER")
}

enum Method {
  LDDAP
  CHECK
}

enum PayeeType {
  SUPPLIER
  EMPLOYEE
}

enum LddapMethod {
  ONLINE
  MANUAL
}

enum Status {
  PAID
  PENDING
}

enum Reset {
  MONTHLY
  YEARLY
  NONE
}
